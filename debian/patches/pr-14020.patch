From 57dba6ec933c415bb9dc0f894ea048864cb6f589 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?=D0=BD=D0=B0=D0=B1?= <nabijaczleweli@nabijaczleweli.xyz>
Date: Tue, 11 Oct 2022 23:30:46 +0200
Subject: [PATCH] etc: mask zfs-load-key.service
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Otherwise, systemd-sysv-generator will generate a service equivalent
that breaks the boot: under systemd this is covered by
zfs-mount-generator

We already do this for zfs-import.service, and other init scripts are
suppressed automatically by the "actual" .service files

Closes: #14010
Signed-off-by: Ahelenia Ziemia≈Ñska <nabijaczleweli@nabijaczleweli.xyz>
Fixes: commit f04b97620059d08b37d9e80ada397e742bb2f311 ("Add init script
 to load keys")
Backport-of: #14019
---
 etc/systemd/system/Makefile.am | 1 +
 1 file changed, 1 insertion(+)

Index: zfs-linux/etc/systemd/system/Makefile.am
===================================================================
--- zfs-linux.orig/etc/systemd/system/Makefile.am
+++ zfs-linux/etc/systemd/system/Makefile.am
@@ -23,3 +23,4 @@ SUBSTFILES += $(systemdpreset_DATA) $(sy
 install-data-hook:
 	$(MKDIR_P) "$(DESTDIR)$(systemdunitdir)"
 	ln -sf /dev/null "$(DESTDIR)$(systemdunitdir)/zfs-import.service"
+	ln -sf /dev/null "$(DESTDIR)$(systemdunitdir)/zfs-load-key.service"
